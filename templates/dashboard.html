<!-- templates/dashboard.html -->
{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<h2>Welcome, {{ current_user.company_name }}</h2>
<div class="row">
    <div class="col-md-6">
        <h3>Carbon Footprint Over Time</h3>
        <canvas id="lineChart"></canvas>
    </div>
    <div class="col-md-6">
        <h3>Breakdown by Source per Month</h3>
        <canvas id="barChart"></canvas>
    </div>
</div>
<div class="row mt-4">
    <div class="col-md-6">
        <h3>Source Contributions</h3>
        <canvas id="pieChart"></canvas>
    </div>
    <div class="col-md-6">
        <h3>Trend Analysis</h3>
        <p>Change from previous month: {{ chart_data.trend_pct }}%</p>
        <h3>Emission Intensity Score</h3>
        <div class="alert alert-info" role="alert">
            <strong>{{ chart_data.score }}/100</strong>
        </div>
    </div>
</div>

<script>
    const ctxLine = document.getElementById('lineChart').getContext('2d');
    new Chart(ctxLine, {
        type: 'line',
        data: {
            labels: {{ chart_data.line.labels | tojson }},
            datasets: [{
                label: 'CO2e Emissions (kg)',
                data: {{ chart_data.line.data | tojson }},
                borderColor: 'rgba(75, 192, 192, 1)',
                tension: 0.1
            }]
        },
        options: { animations: { tension: { duration: 1000, easing: 'linear' } } }
    });

    const ctxBar = document.getElementById('barChart').getContext('2d');
    new Chart(ctxBar, {
        type: 'bar',
        data: {
            labels: {{ chart_data.bar.labels | tojson }},
            datasets: {{ chart_data.bar.datasets | tojson }}
        },
        options: {
            scales: { x: { stacked: true }, y: { stacked: true } },
            animations: { duration: 1000 }
        }
    });

    const ctxPie = document.getElementById('pieChart').getContext('2d');
    new Chart(ctxPie, {
        type: 'pie',
        data: {
            labels: {{ chart_data.pie.labels | tojson }},
            datasets: [{
                data: {{ chart_data.pie.data | tojson }},
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#E7E9ED', '#C9CBCF', '#ADFF2F', '#FFD700']
            }]
        },
        options: { animations: { borderWidth: { duration: 1000, easing: 'easeOutBounce' } } }
    });
</script>
{% endblock %}